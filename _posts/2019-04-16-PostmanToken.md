---
layout: post
title: "postman如何设置全局变量"
subtitle: '你所不知道的Postman强大的用途'
author: "Haauleon"
header-style: text
tags:
  - Postman
  - 全局变量
---

&emsp;&emsp;最近在测的大部分接口都需要身份认证，然后这些用到认证的接口总是需要频繁的手动加上token，这样效率真的很低，为了提高作战效率，就得用到postman自带的全局变量设置功能，真的炒鸡好用！




## 为什么要用到身份认证
&emsp;&emsp;通俗点讲就是你去参加毛不易的演唱会，你肯定要先买票才能进到会场吧，那么在进场之前都会有一个验票的检查，需要验证你是否买了票。一般票面上都会有一个二维码，这个二维码储存的就是你的购票信息，当然你也可以理解为是你的个人身份信息。这个时候你拿着这张票去过闸机，验票通过你才可以进场。所以验票这一环节你就可以想成是身份认证。想象一下，如果没有身份认证，也就意味着不管你有票没票都可以进场，而场内的位置是固定的，就会造成已买票的人没位置坐，没买票的人也可以看演唱会，场内可谓是极度混乱。好的，收！现在进入正题。

## 认证的接口要怎么测试
&emsp;&emsp;一般测试要用到认证的接口是需要手动在Header中加上token的，具体的接口请求方式我就不说了，毕竟不同团队不同姿势。如果不加token会是什么样子呢？这不是废话嘛，当然是请求失败。如下图，该接口是用来获取会员的基本信息的。                

![](\img\in-post\2019-04-16-PostmanToken\1.jpg)         

正确的操作姿势如下。

### 第一步 请求登录接口
首先需要请求登录接口，获取接口返回的token。        

![](\img\in-post\2019-04-16-PostmanToken\2.jpg)

### 第二步 请求头加token
在需要身份认证的接口的请求头Headers中加入token，发送请求，请求成功。         

![](\img\in-post\2019-04-16-PostmanToken\3.jpg)

## 消除手工更新token的烦恼
&emsp;&emsp;上面是一个接口的测试，如果是二十个接口，岂不是二十个接口都要手动增加>更新token！想想都觉得很心塞啊。毕竟时间宝贵，时间就是生命啊。那么，接下来就讲讲postman设置全局变量。        

## Postman设置全局变量 
&emsp;&emsp;这里总结了我最常用的两种方式：写死和不写死。具体怎么用呢？继续往下看吧。

### 方式一 写死
&emsp;&emsp;“写死”这两个字是不是简单粗暴？嗯，他实际的操作和应用场景也是很简单粗暴。这种方式多用于登录接口返回的token是永远不会远的情况，就是说你第一次登录成功后返回的token和第二第三次...第n次返回的token是一样的，你就可以用这种方式。这种方式除了写死token还可以写死要请求的baseUrl(也就是请求的Host前缀)、每个接口请求时都会用到的一些固定的值等等都是OK的。        

#### 第一步 点击眼睛eye
不是你的眼睛，是postman上的这个logo。         

![](\img\in-post\2019-04-16-PostmanToken\4.jpg)

#### 第二步 点击编辑Edit
这一步是为了编辑全局变量GlobalVariables。       

![](\img\in-post\2019-04-16-PostmanToken\5.jpg)

#### 第三步 设置全局变量
输入变量名和当前值，初始值没有可以不用写。你也可以理解为键值对的格式，填写完点击保存。                 

![](\img\in-post\2019-04-16-PostmanToken\6.jpg) 

#### 第四步 检查全局变量
保存成功后再检查一下有没有填写正确，图片上的步骤编号不正确，好吧，我的错。         

![](\img\in-post\2019-04-16-PostmanToken\7.jpg)      

#### 第五步 使用全局变量
设置成功后，就来试试手吧。使用全局变量的格式是：{{变量名}}，这里填写的就是刚刚保存好的token。很好，请求成功。         

![](\img\in-post\2019-04-16-PostmanToken\8.jpg)   

### 方式二 不写死
&emsp;&emsp;这种几乎是我最常用的方式了，这种方式会被用在什么场景呢？一句讲晒，就是返回的值变化无常。用在token的身上，就是说每一次请求登录接口返回的token都不一样。在这种情况下，如果还是沿用方式一写死的话，就会造成token一变那么涉及到需要token的接口请求时全部报错，或者你换个登录账号时token也会变，这是不可控的。在这种情况下要手动挨个接口去更新，那真的是......         

#### 第一步 编辑Tests脚本
在登录接口的测试脚本内加入两行代码，就这么简单搞定。      

```
/*定义一个响应体res，获取body中所有的参数并以json格式返回*/
var res = JSON.parse(responseBody);

/*获取res.token的值并保存在全局变量token中*/
postman.setGlobalVariable("token2","Token " + res.token);
```         
&emsp;&emsp;有空的话玩一下它提供的snippets也是很不错的。        

![](\img\in-post\2019-04-16-PostmanToken\9.jpg)

#### 第二步 请求登录接口
测试代码写完之后，请求一下登录接口，这时会发现全局变量编辑框内新增了一个变量token2且已被赋值。用这种方式，每一次请求登录接口，都会更新到token2对应的值。         

![](\img\in-post\2019-04-16-PostmanToken\10.jpg)        

#### 第三步 使用全局变量 
全局变量的使用方式不变，还是{{变量名}}。         

![](\img\in-post\2019-04-16-PostmanToken\11.jpg)